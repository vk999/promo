!function(t){"use strict";function e(e,i){var l=this,o=e.attr("name")||i.name||"";this.options=i,this.$el=e.hide(),this.$label=this.$el.closest("label"),0===this.$label.length&&this.$el.attr("id")&&(this.$label=t(s('label[for="%s"]',this.$el.attr("id").replace(/:/g,"\\:")))),this.$parent=t(s('<div class="ms-parent %s" %s/>',e.attr("class")||"",s('title="%s"',e.attr("title")))),this.$choice=t(s(['<button type="button" class="ms-choice">','<span class="placeholder">%s</span>',"<div></div>","</button>"].join(""),this.options.placeholder)),this.$drop=t(s('<div class="ms-drop %s"%s></div>',this.options.position,s(' style="width: %s"',this.options.dropWidth))),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",this.options.width||this.$el.css("width")||this.$el.outerWidth()+20),this.selectAllName='data-name="selectAll'+o+'"',this.selectGroupName='data-name="selectGroup'+o+'"',this.selectItemName='data-name="selectItem'+o+'"',this.options.keepOpen||t(document).click(function(s){t(s.target)[0]!==l.$choice[0]&&t(s.target).parents(".ms-choice")[0]!==l.$choice[0]&&(t(s.target)[0]===l.$drop[0]||t(s.target).parents(".ms-drop")[0]!==l.$drop[0]&&s.target!==e[0])&&l.options.isOpen&&l.close()})}var s=function(t){var e=arguments,s=!0,i=1;return t=t.replace(/%s/g,function(){var t=e[i++];return"undefined"==typeof t?(s=!1,""):t}),s?t:""};e.prototype={constructor:e,init:function(){var e=this,i=t("<ul></ul>");this.$drop.html(""),this.options.filter&&this.$drop.append(['<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>"].join("")),this.options.selectAll&&!this.options.single&&i.append(['<li class="ms-select-all">',"<label>",s('<input type="checkbox" %s /> ',this.selectAllName),this.options.selectAllDelimiter[0],this.options.selectAllText,this.options.selectAllDelimiter[1],"</label>","</li>"].join("")),t.each(this.$el.children(),function(t,s){i.append(e.optionToHtml(t,s))}),i.append(s('<li class="ms-no-results">%s</li>',this.options.noMatchesFound)),this.$drop.append(i),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find("input["+this.selectAllName+"]"),this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]"),this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled"),this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled"),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()},optionToHtml:function(e,i,l,o){var n,c=this,h=t(i),p=h.attr("class")||"",a=s('title="%s"',h.attr("title")),r=this.options.multiple?"multiple":"",d=this.options.single?"radio":"checkbox";if(h.is("option")){var u,f=h.val(),m=c.options.textTemplate(h),$=h.prop("selected"),g=s('style="%s"',this.options.styler(f));return n=o||h.prop("disabled"),u=t([s('<li class="%s %s" %s %s>',r,p,a,g),s('<label class="%s">',n?"disabled":""),s('<input type="%s" %s%s%s%s>',d,this.selectItemName,$?' checked="checked"':"",n?' disabled="disabled"':"",s(' data-group="%s"',l)),m,"</label>","</li>"].join("")),u.find("input").val(f),u}if(h.is("optgroup")){var k=c.options.labelTemplate(h),v=t("<div/>");return l="group_"+e,n=h.prop("disabled"),v.append(['<li class="group">',s('<label class="optgroup %s" data-group="%s">',n?"disabled":"",l),this.options.hideOptgroupCheckboxes||this.options.single?"":s('<input type="checkbox" %s %s>',this.selectGroupName,n?'disabled="disabled"':""),k,"</label>","</li>"].join("")),t.each(h.children(),function(t,e){v.append(c.optionToHtml(t,e,l,n))}),v.html()}},events:function(){var e=this,i=function(t){t.preventDefault(),e[e.options.isOpen?"close":"open"]()};this.$label&&this.$label.off("click").on("click",function(t){"label"===t.target.nodeName.toLowerCase()&&t.target===this&&(i(t),e.options.filter&&e.options.isOpen||e.focus(),t.stopPropagation())}),this.$choice.off("click").on("click",i).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(t){switch(t.which){case 27:e.close(),e.$choice.focus()}}),this.$searchInput.off("keydown").on("keydown",function(t){9===t.keyCode&&t.shiftKey&&e.close()}).off("keyup").on("keyup",function(t){return e.options.filterAcceptOnEnter&&(13===t.which||32==t.which)&&e.$searchInput.val()?(e.$selectAll.click(),e.close(),void e.focus()):void e.filter()}),this.$selectAll.off("click").on("click",function(){var s=t(this).prop("checked"),i=e.$selectItems.filter(":visible");i.length===e.$selectItems.length?e[s?"checkAll":"uncheckAll"]():(e.$selectGroups.prop("checked",s),i.prop("checked",s),e.options[s?"onCheckAll":"onUncheckAll"](),e.update())}),this.$selectGroups.off("click").on("click",function(){var i=t(this).parent().attr("data-group"),l=e.$selectItems.filter(":visible"),o=l.filter(s('[data-group="%s"]',i)),n=o.length!==o.filter(":checked").length;o.prop("checked",n),e.updateSelectAll(),e.update(),e.options.onOptgroupClick({label:t(this).parent().text(),checked:n,children:o.get(),instance:e})}),this.$selectItems.off("click").on("click",function(){if(e.updateSelectAll(),e.update(),e.updateOptGroupSelect(),e.options.onClick({label:t(this).parent().text(),value:t(this).val(),checked:t(this).prop("checked"),instance:e}),e.options.single&&e.options.isOpen&&!e.options.keepOpen&&e.close(),e.options.single){var s=t(this).val();e.$selectItems.filter(function(){return t(this).val()!==s}).each(function(){t(this).prop("checked",!1)}),e.update()}})},open:function(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop[this.animateMethod("show")](),this.$selectAll.parent().show(),this.$noResults.hide(),this.$el.children().length||(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){var e=this.$drop.offset();this.$drop.appendTo(t(this.options.container)),this.$drop.offset({top:e.top,left:e.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen()}},close:function(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop[this.animateMethod("hide")](),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},animateMethod:function(t){var e={show:{fade:"fadeIn",slide:"slideDown"},hide:{fade:"fadeOut",slide:"slideUp"}};return e[t][this.options.animate]||t},update:function(e){var i=this.options.displayValues?this.getSelects():this.getSelects("text"),l=this.$choice.find(">span"),o=i.length;0===o?l.addClass("placeholder").html(this.options.placeholder):this.options.allSelected&&o===this.$selectItems.length+this.$disableItems.length?l.removeClass("placeholder").html(this.options.allSelected):this.options.ellipsis&&o>this.options.minimumCountSelected?l.removeClass("placeholder").text(i.slice(0,this.options.minimumCountSelected).join(this.options.delimiter)+"..."):this.options.countSelected&&o>this.options.minimumCountSelected?l.removeClass("placeholder").html(this.options.countSelected.replace("#",i.length).replace("%",this.$selectItems.length+this.$disableItems.length)):l.removeClass("placeholder").text(i.join(this.options.delimiter)),this.options.addTitle&&l.prop("title",this.getSelects("text")),this.$el.val(this.getSelects()).trigger("change"),this.$drop.find("li").removeClass("selected"),this.$drop.find(s("input[%s]:checked",this.selectItemName)).each(function(){t(this).parents("li").first().addClass("selected")}),e||this.$el.trigger("change")},updateSelectAll:function(t){var e=this.$selectItems;t||(e=e.filter(":visible")),this.$selectAll.prop("checked",e.length&&e.length===e.filter(":checked").length),!t&&this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var e=this.$selectItems.filter(":visible");t.each(this.$selectGroups,function(i,l){var o=t(l).parent().attr("data-group"),n=e.filter(s('[data-group="%s"]',o));t(l).prop("checked",n.length&&n.length===n.filter(":checked").length)})},getSelects:function(e){var i=this,l=[],o=[];return this.$drop.find(s("input[%s]:checked",this.selectItemName)).each(function(){l.push(t(this).parents("li").first().text()),o.push(t(this).val())}),"text"===e&&this.$selectGroups.length&&(l=[],this.$selectGroups.each(function(){var e=[],o=t.trim(t(this).parent().text()),n=t(this).parent().data("group"),c=i.$drop.find(s('[%s][data-group="%s"]',i.selectItemName,n)),h=c.filter(":checked");if(h.length){if(e.push("["),e.push(o),c.length>h.length){var p=[];h.each(function(){p.push(t(this).parent().text())}),e.push(": "+p.join(", "))}e.push("]"),l.push(e.join(""))}})),"text"===e?l:o},setSelects:function(e){var i=this;this.$selectItems.prop("checked",!1),t.each(e,function(t,e){i.$selectItems.filter(s('[value="%s"]',e)).prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length),t.each(i.$selectGroups,function(e,s){var l=t(s).parent().attr("data-group"),o=i.$selectItems.filter('[data-group="'+l+'"]');t(s).prop("checked",o.length&&o.length===o.filter(":checked").length)}),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},focus:function(){this.$choice.focus(),this.options.onFocus()},blur:function(){this.$choice.blur(),this.options.onBlur()},refresh:function(){this.init()},filter:function(){var e=this,i=t.trim(this.$searchInput.val()).toLowerCase();0===i.length?(this.$selectAll.parent().show(),this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show(),this.$noResults.hide()):(this.$selectItems.each(function(){var e=t(this).parent();e[e.text().toLowerCase().indexOf(i)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var i=t(this).parent(),l=i.attr("data-group"),o=e.$selectItems.filter(":visible");i[o.filter(s('[data-group="%s"]',l)).length?"show":"hide"]()}),this.$selectItems.parent().filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll(),this.options.onFilter(i)}},t.fn.multipleSelect=function(){var s,i=arguments[0],l=arguments,o=["getSelects","setSelects","enable","disable","open","close","checkAll","uncheckAll","focus","blur","refresh","close"];return this.each(function(){var n=t(this),c=n.data("multipleSelect"),h=t.extend({},t.fn.multipleSelect.defaults,n.data(),"object"==typeof i&&i);if(c||(c=new e(n,h),n.data("multipleSelect",c)),"string"==typeof i){if(t.inArray(i,o)<0)throw"Unknown method: "+i;s=c[i](l[1])}else c.init(),l[1]&&(s=c[l[1]].apply(c,[].slice.call(l,2)))}),"undefined"!=typeof s?s:this},t.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllDelimiter:["[","]"],minimumCountSelected:3,ellipsis:!1,multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,dropWidth:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,animate:"none",displayValues:!1,delimiter:", ",addTitle:!1,filterAcceptOnEnter:!1,hideOptgroupCheckboxes:!1,selectAllText:"Select all",allSelected:"All selected",countSelected:"# of % selected",noMatchesFound:"No matches found",styler:function(){return!1},textTemplate:function(t){return t.text()},labelTemplate:function(t){return t.attr("label")},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1},onFilter:function(){return!1}}}(jQuery);